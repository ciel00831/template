<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.tiny.dao.MemberDao">
	<resultMap id="result" type="member">
		<result property="providerUserId" column="providerUserId" />
		<result property="email" column="email" />
		<result property="name" column="name" />
		<result property="gender" column="gender" />
		<result property="point" column="point" />
		<result property="documentCount" column="documentCount" />
		<result property="commentCount" column="commentCount" />
		<result property="likeCount" column="likeCount" />
		<result property="dislikeCount" column="dislikeCount" />
		<result property="locale" column="locale" />
		<result property="isAdmin" column="isAdmin" />
		<result property="regDate" column="regDate" />
		<result property="lastLogin" column="lastLogin" />
	</resultMap>
	
	<insert id="save" parameterType="member">
		INSERT
		INTO member
				(providerUserId,
				email,
				name,
				gender,
				point,
				documentCount,
				commentCount,
				likeCount,
				dislikeCount,
				locale,
				isAdmin,
				regDate,
				lastLogin)
		VALUES (#{providerUserId},
				#{email},
				#{name},
				#{gender},
				#{point},
				#{documentCount},
				#{commentCount},
				#{likeCount},
				#{dislikeCount},
				#{locale},
				#{isAdmin},
				NOW(),
				NOW());
	</insert>
	
	<select id="getAll" resultMap="result">
		SELECT *
		FROM member;
	</select>
	
	<select id="get" resultType="member">
		SELECT *
		FROM member
		WHERE providerUserId = #{value}
	</select>
	
	<select id="count" resultType="int">
		SELECT COUNT(*)
		FROM member;
	</select>
	
	<update id="update" parameterType="member">
  		UPDATE member
  		SET
			email = #{email},
			name = #{name},
			gender = #{gender},
			point = #{point},
			documentCount = #{documentCount},
			commentCount = #{commentCount},
			likeCount = #{likeCount},
			dislikeCount = #{dislikeCount},
			locale = #{locale},
			isAdmin = #{isAdmin},
			lastLogin = NOW()
  		where providerUserId = #{providerUserId};
	</update>
	
	<update id="updateLastLogin" parameterType="String">
  		UPDATE member
  		SET
			lastLogin = NOW()
  		where providerUserId = (
	  		SELECT providerUserId FROM UserConnection WHERE userId = #{userId}
  		);
	</update>
	
	<delete id="delete" parameterType="String">
		DELETE
		FROM member
		WHERE providerUserId = #{providerUserId};
	</delete>
</mapper>